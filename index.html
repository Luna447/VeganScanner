<!doctype html>
<html lang="de">
<head>
  <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAWlBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////8rEixlAAAAH3RSTlMAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyEjrUc6AAAAQ0lEQVQYV2NgAAKMDIxMjEwMLAzEwMDIxMjY0NjE0NjIwNDAwNDM0NDAyNzA0NDAwNjAwNjEwMDQ0MDAwAAAzRgMMzQe2ywAAAABJRU5ErkJggg==" type="image/png">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vegan Scanner</title>
  <meta name="theme-color" content="#0f766e">
  <style>
    html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica Neue,Arial;background:#0b1212;color:#e6f2ef}
    header{padding:16px;background:#0f766e;color:#fff;font-weight:700}
    main{padding:16px;max-width:860px;margin:auto;display:grid;gap:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    button{background:#0f766e;color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
    details{background:#0e1a19;border:1px solid #123534;border-radius:10px;padding:10px}
    pre{white-space:pre-wrap;word-break:break-word;background:#091212;padding:12px;border-radius:8px}
    .muted{opacity:.8;font-size:.9rem}
  </style>
</head>
<body>
  <header>Vegan-Check (offline + hybrid)</header>
  <main>
    <div class="row">
      <input id="file" type="file" accept="image/*">
      <button id="scanBtn">Scannen</button>
      <button id="resetBtn">Zurücksetzen</button>
      <span id="status" class="muted"></span>
    </div>

    <details>
      <summary>Zutaten-Text (OCR)</summary>
      <pre id="ocrOut"></pre>
    </details>

    <details>
      <summary>Treffer</summary>
      <pre id="hitsOut">Noch keine Logik hier. Erst OCR reparieren, danach Regeln.</pre>
    </details>

    <p class="muted">Hinweis: OCR läuft lokal. Sprachdaten liegen im Projekt.</p>
  </main>

  <!-- Einmaliger Cleanup -->
  <script>
    (async () => {
      try {
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          for (const r of regs) await r.unregister();
        }
        if (window.caches) {
          const keys = await caches.keys();
          for (const k of keys) await caches.delete(k);
        }
        console.log('[Cleanup] SW & Cache geleert');
      } catch(e) { console.warn('[Cleanup] Problem:', e); }
    })();
  </script>

<!-- Tesseract v5.0.5 direkt vom CDN -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.5/dist/tesseract.min.js"></script>
<script src="app.nov.js" defer></script>

<!-- index.html: feste Version + Mini-Cachebuster -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.5/dist/tesseract.min.js?v=505"></script>
<script src="app.nov.js?v=505" defer></script>


</body>
</html>
